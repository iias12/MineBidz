@model MineBidz.Models.CreateBidGuestViewModel

@{
    ViewBag.Title = "Create";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using (Html.BeginForm("Create", "Guest", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    @Html.ValidationSummary()
    
    <div id="companyInfo" class="companyInfo">
        @{Html.RenderPartial("PartialCompanyInfo");}
    </div>
    @Html.HiddenFor(model => model.RequestInfo.RequestInfoId)
    <div id="quoteInfo" class="companyInfo">
        @{Html.RenderPartial("PartialQuoteInfo");}
    </div>
    <div id="paymentInfo" class="companyInfo">
        @{Html.RenderPartial("PartialPaymentInfo");}
    </div>
    <div style="clear: both; float: right; margin-right: 5px">
        <input type="submit" value="Submit" />
    </div>
}

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")

    <script type="text/javascript">
        $("document").ready(
            function () {
                addressDropdowns($("#ddlCountriesCompany"), $("#ddlProvincesCompany"));
                addressDropdowns($("#ddlCountriesBilling"), $("#ddlProvincesBilling"));
            }
        );

    function addressDropdowns(ddlCountries, ddlStates) {
        ddlCountries.change(function () {
            var selectedCountryCode = $(this).val();
            if (!selectedCountryCode) {
                ddlStates.empty();
                ddlStates.append(
                        $('<option/>')
                                .attr('value', '')
                                .text('--Select Country First--'));
                return;
            }
            $.getJSON('@Url.Action("ProvincesStates", "Forms")', { countryCode: selectedCountryCode }, function (provinces) {
                ddlStates.empty();
                if (provinces.length > 0) {
                    ddlStates.append(
                        $('<option/>')
                                .attr('value', '')
                                .text('--Please Select--')
                    );
                }
                else {
                    ddlStates.append(
                        $('<option/>')
                                .attr('value', 'NA')
                                .text('N/A')
                    );
                }
                $.each(provinces, function (index, province) {
                    ddlStates.append(
                            $('<option/>')
                                .attr('value', province.ProvinceStateCode)
                                .text(province.ProvinceStateName)
                    );
                });
            });
        });
    }

        // extend jquery range validator to work for required checkboxes
        var defaultRangeValidator = $.validator.methods.range;
        $.validator.methods.range = function (value, element, param) {
            if (element.type === 'checkbox') {
                // if it's a checkbox return true if it is checked
                return element.checked;
            } else {
                // otherwise run the default validation function
                return defaultRangeValidator.call(this, value, element, param);
            }
        }

    </script>
}

